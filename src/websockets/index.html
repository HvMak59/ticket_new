<!DOCTYPE html>
<html>

<head>
    <title>Telemetry WebSocket</title>
</head>

<body>
    <h1>Telemetry Payload Demo</h1>

    <button id="btnSubA">Subscribe Metric A</button>
    <button id="btnSubB">Subscribe Metric B</button>

    <h2>Incoming Data</h2>
    <div id="data"></div>

    <script>
        // Connect WebSocket
        const socket = new WebSocket('ws://localhost:3000');

        socket.addEventListener('open', () => {
            console.log('Connected to WebSocket server');
        });

        socket.addEventListener('message', (event) => {
            try {
                const data = JSON.parse(event.data);
                console.log("Incoming:", data);

                const div = document.createElement("div");
                div.innerHTML = `
          <pre>${JSON.stringify(data, null, 2)}</pre>
          <hr/>
        `;
                document.getElementById('data').prepend(div);
            } catch (err) {
                console.error("Invalid message:", event.data);
            }
        });

        socket.addEventListener('close', () => {
            console.log("Disconnected from WebSocket");
        });

        socket.addEventListener('error', (err) => {
            console.error("WebSocket error:", err);
        });

        // Send subscription message (MATCHES BACKEND)
        function subscribe(metricId) {
            const payload = {
                virtualDeviceIds: ["1:first"],   // can be multiple
                metricsAttributeId: metricId
            };

            socket.send(JSON.stringify(payload));
            console.log("Subscribed:", payload);
        }

        // Buttons
        document.getElementById("btnSubA")
            .addEventListener("click", () => subscribe("metrics_4"));

        document.getElementById("btnSubB")
            .addEventListener("click", () => subscribe("longitude"));
    </script>
</body>

</html>